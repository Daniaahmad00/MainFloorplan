<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8FA Private Suite Floorplan</title>
</head>

<body>
  <h1>8FA Floorplan</h1>
  <div class="floorplan-container">
    <object id="8FAFloorplan" data="8FA.svg" type="image/svg+xml"></object>
  </div>

  <div id="popup" class="popup"
    style="display:none; position:absolute; background:white; border:1px solid #ccc; padding:10px;">
    <span onclick="closePopup()" style="cursor:pointer">&times;</span>
    <h3 id="popupRoomName"></h3>
    <p>Status: <span id="popupStatus"></span></p>
  </div>

  <script>
    let roomData = {};
    const statusColors = {
      available: "rgba(50, 185, 54, 0.85)",        // Green
      available_soon: "rgba(255, 215, 0, 0.85)",   // Yellow
      occupied: "rgba(235, 51, 38, 0.85)",         // Red
      reserved: "rgba(0, 123, 255, 0.85)",         // Blue
      unavailable: "rgba(128, 128, 128, 0.85)"     // Gray
    };
    fetch("https://script.google.com/macros/s/AKfycbxq5mOtzhtRcU_e99UG2Q8rXhOkbroXvP8eKE87GC8aLvrwf05EYLsv9cTXieXix0g0/exec?outlet_id=67ad665a9aa9ef620e693aa0")
      .then(r => r.json())
      .then(data => {
        data.forEach(item => {
          roomData[item.id] = {
            id: item.id,
            name: item.name,
            status: item.status.toLowerCase()
          };
        });
        setupSVG();
      });

    function setupSVG() {
      const svgObj = document.getElementById("8FAFloorplan");
      if (svgObj.contentDocument) {
        window.parent.postMessage("ready", "*");
      } else {
        svgObj.addEventListener("load", () => {
          window.parent.postMessage("ready", "*");
        });
      }
    }

    window.addEventListener("message", (event) => {
      const { roomIds = [], statusFilter = "all", statusMap = {} } = event.data || {};
      const svgDoc = document.getElementById("8FAFloorplan").contentDocument;
      if (!svgDoc) return;

      // fade all
      svgDoc.querySelectorAll("[id]").forEach(el => {
        el.style.fill = "#ccc";
        el.style.opacity = "0.2";
      });

      // highlight based on filter
      roomIds.forEach(id => {
        const el = svgDoc.getElementById(id);
        if (!el) return;
        const roomStatus = statusMap[id] || roomData[id]?.status;
        if (statusFilter === "all" || roomStatus === statusFilter) {
          const fillColor = statusColors[roomStatus] || "#ccc";
          el.style.fill = fillColor;
          el.style.opacity = "1";
        }
      });

      // notify parent that filtering applied
      window.parent.postMessage("applied", "*");
    });

    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }
  </script>
</body>

</html>